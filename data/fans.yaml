- platform: template
  fans:
    powder_bath_fan:
      unique_id: powder_bath_fan
      friendly_name: "Powder Bath Fan"
      value_template: "{{ states('light.powder_bath_fan_on_off') }}"
      turn_on:
        service: light.turn_on
        target:
          entity_id:
            - light.powder_bath_fan_on_off
      turn_off:
        service: light.turn_off
        target:
          entity_id:
            - light.powder_bath_fan_on_off
- platform: template
  fans:
    master_bath_fan:
      unique_id: master_bath_fan
      friendly_name: "Master Bath Fan"
      value_template: "{{ states('light.master_bath_fan_on_off') }}"
      turn_on:
        service: light.turn_on
        target:
          entity_id:
            - light.master_bath_fan_on_off
      turn_off:
        service: light.turn_off
        target:
          entity_id:
            - light.master_bath_fan_on_off

- platform: template
  fans:
    gym:
      unique_id: gym
      friendly_name: "gym fan"
      value_template: "{{ states('input_boolean.gym_fan_state') }}"
      percentage_template: "{{ states('input_number.gym_fan_percentage') }}"
      <<: &broadlink_fan # inspired by https://github.com/thomasloven/hass-config/wiki/Misc-tricks#merge-key-
        turn_on:
          service: script.broadlink_fan_on
          data:
            entity: '{{ this.object_id }}'
        turn_off:
          service: script.broadlink_fan_off
          data:
            entity: '{{ this.object_id }}'
        set_percentage:
          service: script.broadlink_fan_set_speed
          data:
            percentage: "{{ percentage }}"
            entity: '{{ this.object_id }}'
        speed_count: 7
